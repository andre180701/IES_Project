<!DOCTYPE html>
<html xmlns:th="https://www.thymeleaf.org">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Star Admin Premium Bootstrap Admin Dashboard Template</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="../assets/vendors/iconfonts/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="../assets/vendors/iconfonts/ionicons/dist/css/ionicons.css">
    <link rel="stylesheet" href="../assets/vendors/iconfonts/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="../assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="../assets/vendors/css/vendor.bundle.addons.css">
    <!-- endinject -->
    <!-- plugin css for this page -->
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="../assets/css/shared/style.css">
    <link rel="stylesheet" href="../assets/css/mbm/styles_mbm.css">
    <!-- endinject -->
    <link rel="shortcut icon" href="../assets/images/favicon.ico" />
  </head>
  <body>
    <div class="container-scroller">
      
      <div class="container-fluid page-body-wrapper full-page-wrapper">
        
        <div class="content-wrapper d-flex align-items-center auth auth-bg-1 theme-one">
          <div class="row w-100">
            <div class="col-lg-4 mx-auto">
              <h3 style="text-align: center;">Login</h3>
              <a href="">
                <img src="../assets/images/dashboard/cross.png" class="edit_icon">
              </a>
              <div class="auto-form-wrapper">
                <form action="#"  th:action="@{/login/check}" th:object="${inputLogin}" method="post">
                  <div class="form-group">
                    <label class="label">Email</label>
                    <div class="input-group">
                      <input th:field="*{email}" type="text" class="form-control" placeholder="Email">
                      <div class="input-group-append">
                        <span class="input-group-text">
                          <i class="mdi mdi-check-circle-outline"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <label class="label">Password</label>
                    <div class="input-group">
                      <input th:field="*{password}" type="password" class="form-control" placeholder="*********">
                      <div class="input-group-append">
                        <span class="input-group-text">
                          <i class="mdi mdi-check-circle-outline"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <button type="submit" class="btn btn-primary submit-btn btn-block" style="
                    font-size: 16px;font-weight: 600; background-color: #F96E46; border: none; color: #111111">Login</button>
                  </div>
                  
                  <div class="text-block text-center my-3">
                    <span class="text-small font-weight-semibold">Not a member ?</span>
                    <a href="register" class="text-black text-small">Create new account</a>
                  </div>
                </form>
                <p style="color:#FF0000; text-align: center;" th:text="${error}" />
              </div>
              <ul class="auth-footer">
                <li>
                  <a href="#">Conditions</a>
                </li>
                <li>
                  <a href="#">Help</a>
                </li>
                <li>
                  <a href="#">Terms</a>
                </li>
              </ul>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="../assets/vendors/js/vendor.bundle.base.js"></script>
    <script src="../assets/vendors/js/vendor.bundle.addons.js"></script>
    <!-- endinject -->
    <!-- inject:js -->
    <script src="../assets/js/shared/off-canvas.js"></script>
    <script src="../assets/js/shared/misc.js"></script>
    <!-- endinject -->
    <script src="../assets/js/shared/jquery.cookie.js" type="text/javascript"></script>
    <script>
    'use strict';

    document.querySelector('#welcomeForm').addEventListener('submit', connect, true)
    document.querySelector('#dialogueForm').addEventListener('submit', sendMessage, true)

    var stompClient = null;

    var name = null; function connect(event) {
      name = document.querySelector('#name').value.trim();
      if (name) {
        document.querySelector('#welcome-page').classList.add('hidden');
        document.querySelector('#dialogue-page').classList.remove('hidden');
        var socket = new SockJS('/websocketApp');
        stompClient = Stomp.over(socket);
        stompClient.connect({}, connectionSuccess);
      }
      event.preventDefault();
    }
    function connectionSuccess() {
      stompClient.subscribe('/topic/javainuse', onMessageReceived);
      stompClient.send("/app/chat.newUser", {}, JSON.stringify({
        sender: name,
        type: 'newUser'
      }))
    } 
    
    function sendMessage(event) {
      var messageContent = document.querySelector('#chatMessage').value.trim();
      if (messageContent && stompClient) {
        var chatMessage = {
          sender: name,
          content: document.querySelector('#chatMessage').value,
          type: 'CHAT'
        };
        stompClient.send("/app/chat.sendMessage", {}, JSON.stringify(chatMessage));
        document.querySelector('#chatMessage').value = '';
      }
      event.preventDefault();
    }
    
    function onMessageReceived(payload) {
      var message = JSON.parse(payload.body);
      var messageElement = document.createElement('li');
      if (message.type === 'newUser') {
        messageElement.classList.add('event-data');
        message.content = message.sender + 'has joined the chat';
      } else if (message.type === 'Leave') {
        messageElement.classList.add('event-data');
        message.content = message.sender + 'has left the chat';
      } else {
        messageElement.classList.add('message-data');
        var element = document.createElement('i');
        var text = document.createTextNode(message.sender[0]);
        element.appendChild(text);
        messageElement.appendChild(element);
        var usernameElement = document.createElement('span');
        var usernameText = document.createTextNode(message.sender);
        usernameElement.appendChild(usernameText);
        messageElement.appendChild(usernameElement);
      }
      var textElement = document.createElement('p');
      var messageText = document.createTextNode(message.content);
      textElement.appendChild(messageText);
      messageElement.appendChild(textElement);
      document.querySelector('#messageList').appendChild(messageElement);
      document.querySelector('#messageList').scrollTop = document.querySelector('#messageList').scrollHeight;
    }
    </script>
  </body>
</html>